<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PrepAI</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #e9f0e7 0%, #f7faf6 100%);
        color: #222831;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        min-height: 100vh;
        line-height: 1.6;
        font-size: 1rem;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2.5rem;
        background-color: #1e1e1e;
        color: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        position: sticky;
        top: 0;
        z-index: 1000;
        transition: background-color 0.3s ease;
      }
      .navbar .logo {
        font-size: 1.6rem;
        font-weight: 700;
        letter-spacing: 1.2px;
        user-select: none;
        color: #99bc85;
        transition: color 0.3s ease;
      }
      .navbar .logo:hover {
        color: #a8c48e;
      }
      .nav-links {
        list-style: none;
        display: flex;
        gap: 1.8rem;
        margin: 0;
        padding: 0;
      }
      .nav-links a {
        text-decoration: none;
        color: white;
        font-weight: 500;
        font-size: 1.05rem;
        padding: 0.3rem 0.6rem;
        border-radius: 5px;
        transition: background-color 0.3s ease, color 0.3s ease;
      }
      .nav-links a:hover,
      .nav-links a:focus {
        background-color: rgba(153, 188, 133, 0.18);
        color: #99bc85;
        outline: none;
      }

      .container {
        max-width: 1100px;
        margin: 4rem auto 5rem;
        padding: 0 1.5rem;
        position: relative;
        z-index: 1;
      }
      .main-card {
        background: rgba(255, 255, 255, 0.75);
        backdrop-filter: blur(12px);
        border-radius: 18px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05),
          0 12px 30px rgba(0, 0, 0, 0.1);
        padding: 3rem 3.5rem;
        max-width: 900px;
        margin: 0 auto;
        transition: box-shadow 0.3s ease;
      }
      .main-card:hover {
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.07),
          0 16px 40px rgba(0, 0, 0, 0.15);
      }

      h1.main_heading {
        font-weight: 800;
        font-size: 2.6rem;
        color: #222831;
        text-align: center;
        margin-bottom: 2.5rem;
        letter-spacing: 1.2px;
        user-select: none;
      }
      p.main-para {
        font-size: 1.15rem;
        color: #444c38;
        line-height: 1.75;
        max-width: 720px;
        margin: 0 auto 3rem auto;
        text-align: center;
        padding: 0 0.5rem;
      }
      #filechoose {
        font-size: 1.2rem;
        font-weight: 600;
        color: #222831;
        text-align: center;
        margin-bottom: 1.2rem;
        user-select: none;
      }

      #dataset {
        display: block;
        margin: 0 auto 2.2rem auto;
        padding: 0.7rem 1.2rem;
        border-radius: 0.7rem;
        border: 1.8px solid #a8d08d;
        font-size: 1.08rem;
        background: #f7fbf5;
        color: #222831;
        width: 100%;
        max-width: 420px;
        transition: border-color 0.3s, box-shadow 0.3s;
        cursor: pointer;
        box-shadow: inset 0 1px 3px rgb(0 0 0 / 0.05);
      }
      #dataset:focus {
        border-color: #99bc85;
        outline: none;
        box-shadow: 0 0 0 3px #e7f1df;
      }

      #column-select {
        display: none;
        max-width: 420px;
        margin: 0 auto 2.5rem auto;
        text-align: center;
      }
      #column-select label {
        font-weight: 600;
        font-size: 1.1rem;
        color: #222831;
        display: block;
        margin-bottom: 0.5rem;
        user-select: none;
      }
      #column-select select {
        width: 100%;
        padding: 0.6rem 1.1rem;
        font-size: 1rem;
        border-radius: 0.5rem;
        border: 1.5px solid #a8d08d;
        background-color: #f7fbf5;
        color: #222831;
        margin-bottom: 1.3rem;
        transition: border-color 0.3s;
        cursor: pointer;
        box-shadow: inset 0 1px 3px rgb(0 0 0 / 0.05);
        appearance: none;
        background-image: url("data:image/svg+xml;charset=US-ASCII,%3csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2399bc85' viewBox='0 0 16 16'%3e%3cpath d='M1.5 5l6 6 6-6'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 1rem center;
        background-size: 1rem;
      }
      #column-select select:focus {
        border-color: #99bc85;
        outline: none;
        box-shadow: 0 0 0 3px #e7f1df;
      }

      #column-select button {
        font-weight: 600;
        font-size: 1rem;
        border-radius: 0.5rem;
        padding: 0.5rem 1.6rem;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
        transition: background-color 0.3s, box-shadow 0.3s, transform 0.2s;
        user-select: none;
        border: none;
        cursor: pointer;
        min-width: 140px;
        text-align: center;
        background-image: linear-gradient(135deg, #7bbf7f 0%, #a8d08d 100%);
        color: #1e1e1e;
        margin: 0 auto;
        display: block;
      }
      #column-select button:hover,
      #column-select button:focus {
        background-image: linear-gradient(135deg, #a8d08d 0%, #7bbf7f 100%);
        box-shadow: 0 6px 18px rgba(168, 208, 141, 0.7);
        transform: translateY(-2px);
        outline: none;
      }

      #preview,
      #results {
        max-width: 900px;
        margin: 2rem auto;
        padding: 2rem 2.5rem;
        background-color: #fafafa;
        overflow-x: auto;
        border-radius: 12px;
        box-shadow: 0 4px 18px rgb(0 0 0 / 0.07);
        color: #222831;
        word-wrap: break-word;
      }
      #preview h3,
      #results h3,
      #preview h4,
      #results h4 {
        color: #222831;
        margin-top: 0;
        margin-bottom: 1rem;
        font-weight: 700;
      }
      #preview ul,
      #results ul {
        padding-left: 1.2rem;
        color: #444c38;
        margin-bottom: 1.5rem;
      }
      #preview img,
      #results img {
        display: block;
        margin: 1.5rem auto;
        border-radius: 12px;
        max-width: 100%;
        height: auto;
        box-shadow: 0 6px 22px rgb(0 0 0 / 0.12);
      }

      @media (max-width: 768px) {
        .main-card {
          padding: 2rem 1.5rem;
          max-width: 95vw;
        }
        #preview,
        #results {
          margin: 1.5rem 1rem;
          padding: 1.5rem 1rem;
        }
        #dataset,
        #column-select select {
          max-width: 100%;
        }
        #column-select button {
          width: 100%;
          padding: 0.5rem 0;
          font-size: 0.95rem;
          min-width: unset;
        }
      }
    </style>
  </head>
  <body>
    <nav class="navbar" role="navigation" aria-label="Primary Navigation">
      <div class="logo" tabindex="0">PrepAI</div>
      <ul class="nav-links">
        <li><a href="/" tabindex="0">Home</a></li>
        <li><a href="/pre" tabindex="0">Preprocess</a></li>
        <li><a href="/eda" tabindex="0">PlayML</a></li>
        <li><a href="/dash">Dashboard</a></li>
        <li><a href="/aboutus" tabindex="0">About Us</a></li>
      </ul>
    </nav>

    <div class="container">
      <div class="main-card">
        <h1 class="main_heading">ML Visualizer</h1>
        <p class="main-para">
          A comprehensive machine learning visualizer and educational platform.
          As a learner, I found myself constantly scrolling through different
          sites for data analysis tools. ML Visualizer consolidates everything
          in one place, saving time and making it easier for you to visualize,
          learn, and experiment with machine learning algorithms.
        </p>

        <p id="filechoose">Choose a Random Data set below!!</p>

        <input type="file" id="dataset" aria-label="Upload dataset file" />

        <div id="preview" aria-live="polite"></div>
        <div id="results" aria-live="polite"></div>

        <div id="column-select" aria-label="Select target column and algorithm">
          <label for="target">Target Column:</label>
          <select id="target" name="target"></select>

          <label for="algorithm">Choose Algorithm:</label>
          <select id="algorithm" name="algorithm">
            <option value="logistic">Logistic Regression</option>
            <option value="decision_tree">Decision Tree</option>
            <option value="random_forest">Random Forest</option>
            <option value="knn">KNN</option>
            <option value="naive_bayes">Naive Bayes</option>
            <option value="svm">SVM</option>
          </select>

          <button type="button" onclick="trainModel()">
            Train & Visualize
          </button>
        </div>
      </div>
    </div>

    <script>
      let uid = "";
      document
        .getElementById("dataset")
        .addEventListener("change", function () {
          const formData = new FormData();
          formData.append("dataset", this.files[0]);

          fetch("/upload", { method: "POST", body: formData })
            .then((res) => res.json())
            .then((data) => {
              uid = data.uid;
              document.getElementById("preview").innerHTML = data.preview;

              const select = document.getElementById("target");
              select.innerHTML = "";
              data.columns.forEach((col) => {
                const opt = document.createElement("option");
                opt.value = col;
                opt.innerText = col;
                select.appendChild(opt);
              });

              document.getElementById("column-select").style.display = "block";

              let edaHTML = `<h3>EDA Summary</h3>`;
              edaHTML += `<p><strong>Shape:</strong> ${data.eda.shape[0]} rows Ã— ${data.eda.shape[1]} columns</p>`;
              edaHTML += `<h4>Data Types</h4><ul>`;
              for (const [key, value] of Object.entries(data.eda.dtypes)) {
                edaHTML += `<li>${key}: ${value}</li>`;
              }
              edaHTML += `</ul>`;

              edaHTML += `<h4>Missing Values</h4><ul>`;
              for (const [key, value] of Object.entries(data.eda.missing)) {
                edaHTML += `<li>${key}: ${value}</li>`;
              }
              edaHTML += `</ul>`;

              edaHTML += `<h4>Statistics</h4>${data.eda.describe}`;
              edaHTML += `<h4>Last 5 Rows</h4>${data.eda.tail}`;

              if (data.eda.corr_path) {
                edaHTML += `<h4>Correlation Matrix</h4><img src="${data.eda.corr_path}" width="600" alt="Correlation Matrix Heatmap">`;
              }

              document.getElementById("preview").innerHTML += edaHTML;
            });
        });

      function trainModel() {
        const formData = new FormData();
        formData.append("uid", uid);
        formData.append("target", document.getElementById("target").value);
        formData.append(
          "algorithm",
          document.getElementById("algorithm").value
        );

        fetch("/train", { method: "POST", body: formData })
          .then((res) => res.json())
          .then((data) => {
            if (data.error) {
              document.getElementById(
                "results"
              ).innerHTML = `<p style="color:red;">Error: ${data.error}</p>`;
            } else {
              document.getElementById("results").innerHTML = `
              <h3>Accuracy: ${data.accuracy}%</h3>
              <img src="${data.confusion_matrix}" width="500" alt="Confusion Matrix">
            `;
            }
          });
      }
    </script>
  </body>
</html>
